<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="bdHeywatch" title="[bd] Heywatch Integration" version_string="0.9.1" version_id="2" url="" install_callback_class="bdHeywatch_Installer" install_callback_method="install" uninstall_callback_class="bdHeywatch_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="init_dependencies" execute_order="10" callback_class="bdHeywatch_Listener" callback_method="init_dependencies" active="1" hint="" description=""/>
    <listener event_id="load_class" execute_order="10" callback_class="bdHeywatch_Listener" callback_method="load_class" active="1" hint="" description=""/>
    <listener event_id="template_hook" execute_order="10" callback_class="bdHeywatch_Listener" callback_method="template_hook" active="1" hint="page_container_head" description="page_container_head"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="bdHeywatch" display_order="9999" debug_only="0"/>
    <option option_id="bdHeywatch_apiKey" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="10"/>
    </option>
    <option option_id="bdHeywatch_inputExtensions" edit_format="textbox" data_type="string" can_backup="1">
      <default_value>avi
flv
mov
mp4
mpeg
mpg
wmv</default_value>
      <edit_format_params>rows=5</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="1000"/>
    </option>
    <option option_id="bdHeywatch_outputFormats" edit_format="textbox" data_type="string" can_backup="1">
      <default_value>mp4
webm</default_value>
      <edit_format_params>rows=5</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="2000"/>
    </option>
    <option option_id="bdHeywatch_s3Bucket" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="3020"/>
    </option>
    <option option_id="bdHeywatch_s3Key" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="3000"/>
    </option>
    <option option_id="bdHeywatch_s3Region" edit_format="select" data_type="string" can_backup="1">
      <default_value>us-east-1</default_value>
      <edit_format_params>us-east-1=US Standard
us-west-1=Northern California
us-west-2=Oregon
eu-west-1=Irelan
ap-southeast-1=Singapore
ap-southeast-2=Sydney
ap-northeast-1=Tokyo
sa-east-1=Sao Paolo</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="3030"/>
    </option>
    <option option_id="bdHeywatch_s3Secret" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params>type=password</edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdHeywatch" display_order="3010"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="option_bdHeywatch_apiKey" version_id="1" version_string="0.9-dev"><![CDATA[Heywatch API Key]]></phrase>
    <phrase title="option_bdHeywatch_apiKey_explain" version_id="1" version_string="0.9-dev"><![CDATA[Enter your API Key for Heywatch. You need to register at their website and verify account to have production API Key (or your transcoded video will be cut after 5 seconds). The API Key should be available at <a href="https://app.heywatch.com/settings/api_keys" target="_blank" tabindex="-1">this page</a>.]]></phrase>
    <phrase title="option_bdHeywatch_inputExtensions" version_id="1" version_string="0.9-dev"><![CDATA[Source Extensions]]></phrase>
    <phrase title="option_bdHeywatch_inputExtensions_explain" version_id="1" version_string="0.9-dev"><![CDATA[List the file extensions that should be transcoded. Use spaces or line break between extensions.]]></phrase>
    <phrase title="option_bdHeywatch_outputFormats" version_id="1" version_string="0.9-dev"><![CDATA[Output Formats]]></phrase>
    <phrase title="option_bdHeywatch_outputFormats_explain" version_id="1" version_string="0.9-dev"><![CDATA[List the expected formats after transcoding. Use spaces or line break between formats.]]></phrase>
    <phrase title="option_bdHeywatch_s3Bucket" version_id="1" version_string="0.9-dev"><![CDATA[Bucket]]></phrase>
    <phrase title="option_bdHeywatch_s3Bucket_explain" version_id="1" version_string="0.9-dev"><![CDATA[]]></phrase>
    <phrase title="option_bdHeywatch_s3Key" version_id="1" version_string="0.9-dev"><![CDATA[Amazon S3 Key]]></phrase>
    <phrase title="option_bdHeywatch_s3Key_explain" version_id="1" version_string="0.9-dev"><![CDATA[]]></phrase>
    <phrase title="option_bdHeywatch_s3Region" version_id="1" version_string="0.9-dev"><![CDATA[Region]]></phrase>
    <phrase title="option_bdHeywatch_s3Region_explain" version_id="1" version_string="0.9-dev"><![CDATA[]]></phrase>
    <phrase title="option_bdHeywatch_s3Secret" version_id="1" version_string="0.9-dev"><![CDATA[Secret]]></phrase>
    <phrase title="option_bdHeywatch_s3Secret_explain" version_id="1" version_string="0.9-dev"><![CDATA[]]></phrase>
    <phrase title="option_group_bdHeywatch" version_id="1" version_string="0.9-dev"><![CDATA[[bd] Heywatch Integration]]></phrase>
    <phrase title="option_group_bdHeywatch_description" version_id="1" version_string="0.9-dev"><![CDATA[]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="bdheywatch_attached_videos" version_id="1" version_string="0.9-dev"><![CDATA[<xen:foreach loop="$videos" value="$video">
	<xen:if is="{$video.bdheywatch_options}">
		<xen:include template="bdheywatch_video" />
	</xen:if>
</xen:foreach>]]></template>
    <template title="bdheywatch_video" version_id="1" version_string="0.9-dev"><![CDATA[<xen:require js="js/bdHeywatch/video-js/video.js" />

<video id="video-{$video.attachment_id}"
	   class="video-js vjs-default-skin"
	   {xen:if '{$video.bdheywatch_options.thumbnails.0}', 'poster="{$video.bdheywatch_options.thumbnails.0}"'}
	   {xen:if '{$video.bdheywatch_options.width} AND {$video.bdheywatch_options.height}', 'width="{$video.bdheywatch_options.width}" height="{$video.bdheywatch_options.height}"', 'width="720" height="480"'}
	   controls preload="auto">
	<xen:foreach loop="$video.bdheywatch_options.formats" key="$format" value="$url">
		<source src="{$url}" type="{xen:helper bdHeywatch_getMime, $format}" />
	</xen:foreach>
</video>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="bb_code_tag_attach" modification_key="bdheywatch_bb_code_tag_attach" description="Render video inserted into post" execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#^.+$#s]]></find>
      <replace><![CDATA[<xen:if is="{$validAttachment} AND {$canView} AND {$attachment.bdheywatch_options}">

	<xen:include template="bdheywatch_video">
		<xen:map from="$attachment" to="$video" />
	</xen:include>

<xen:else />

$0

</xen:if>]]></replace>
    </modification>
    <modification template="post" modification_key="bdheywatch_post_videos" description="Render videos at the bottom of the post" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:set var="$messageContentAfterTemplate">]]></find>
      <replace><![CDATA[$0<xen:if is="{$post.bdHeywatch_videos}"><xen:include template="bdheywatch_attached_videos">
	<xen:map from="$post.bdHeywatch_videos" to="$videos" />
</xen:include></xen:if>]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
